{"version":3,"file":"rules.cjs","names":["validateRules"],"sources":["../src/rules.ts"],"sourcesContent":["import type {\n  MessageForRuleSet,\n  NamedMessageForRuleSet,\n  RuleStringPatterns,\n} from './interfaces'\nimport { validateRules } from './validate'\n\nexport type RuleStringPattern = {\n  kind: 'pr' | 'commit'\n  rule: string\n  message: string\n}\n\n/**\n * Parse the rule pattern from JSON string\n * this function does not validate the RegExp pattern\n * @param json {string} the JSON string\n * @returns {RuleStringPatterns} the rule pattern\n * @throws {Error} if the JSON is invalid\n * @throws {Error} if the rule pattern is invalid\n */\nfunction parseRulePatternFromJson(json: string): RuleStringPatterns {\n  let parsed: unknown\n  try {\n    parsed = JSON.parse(json)\n  } catch (_e: unknown) {\n    throw new Error('Invalid JSON')\n  }\n  const validated = validateRules(parsed)\n  if (validated) {\n    return parsed as RuleStringPatterns\n  }\n  throw new Error(`Invalid rules: ${JSON.stringify(validateRules.errors)}`)\n}\n\n/**\n * Parse the rule pattern from JSON string and convert it to rule set\n * @param json {string} the JSON string\n * @returns {MessageForRuleSet} the rule set\n * @throws {Error} if the rule is invalid\n * @throws {Error} if the JSON is invalid\n * @throws {Error} if the rule set is invalid\n */\nexport function parseRules(json: string): MessageForRuleSet {\n  const parsed = parseRulePatternFromJson(json)\n  const rules: MessageForRuleSet = []\n  for (const rule of parsed) {\n    try {\n      rules.push({\n        kind: rule.kind,\n        rule: new RegExp(rule.rule),\n        message: rule.message,\n      })\n    } catch (_e: unknown) {\n      throw new Error(`Invalid rule: ${rule.rule}`)\n    }\n  }\n  return rules\n}\n\nexport const Rules: NamedMessageForRuleSet = {\n  pr_reaches_contain_only_one_nonzero_digit: {\n    kind: 'pr',\n    rule: /(?:^[1-9]0+$)/,\n    message: `Now pull request issue number reaches **{{prNum}}**. It's time to celebrate!`,\n  },\n  pr_reaches_power_of_2: {\n    kind: 'pr',\n    rule: /(?:^(512|1024|2048|4096|8192|16384|32768|65536)$)/,\n    message: `Now pull request issue number reaches **{{prNum}}** (power of 2). It's time to celebrate!`,\n  },\n  pr_reaches_777: {\n    kind: 'pr',\n    rule: /(?:^7{3,}$)/,\n    message: `Now pull request issue number reaches **{{prNum}}** (777). It's time to celebrate!`,\n  },\n  commit_hits_777: {\n    kind: 'commit',\n    rule: /(?:7{3,})/,\n    message: 'Commit `{{commitId}}` is lucky! It contains **{{matched}}**!.',\n  },\n  commit_hits_same_numbers: {\n    kind: 'commit',\n    rule: /(?:([0-9a-f])\\1{4,})/,\n    message: 'Commit `{{commitId}}` is lucky! It contains **{{matched}}**!.',\n  },\n  commit_hits_123: {\n    kind: 'commit',\n    rule: /(?:123(?:4(?:5(?:6(?:7(?:8(?:9)?)?)?)?)?)?)/,\n    message: 'Commit `{{commitId}}` is lucky! It contains **{{matched}}**!.',\n  },\n  commit_hits_hexspeak: {\n    kind: 'commit',\n    rule: /(?:(?:f00d|feed|cafe|c0ffee|deadbeef|defecated|0ffice|badcable))/i,\n    message: 'Commit `{{commitId}}` is lucky! It contains **{{matched}}**!.',\n  },\n  commit_hits_666: {\n    kind: 'commit',\n    rule: /(?:666)/,\n    message:\n      'Commit `{{commitId}}` is unlucky... It contains **{{matched}}**!.',\n  },\n} as const\n\nexport type RulesKey = keyof typeof Rules\n"],"mappings":"2CAqBA,SAAS,EAAyB,EAAkC,CAClE,IAAI,EACJ,GAAI,CACF,EAAS,KAAK,MAAM,EAAK,MACL,CACpB,MAAU,MAAM,eAAe,CAGjC,GADkBA,EAAAA,EAAc,EAAO,CAErC,OAAO,EAET,MAAU,MAAM,kBAAkB,KAAK,UAAUA,EAAAA,EAAc,OAAO,GAAG,CAW3E,SAAgB,EAAW,EAAiC,CAC1D,IAAM,EAAS,EAAyB,EAAK,CACvC,EAA2B,EAAE,CACnC,IAAK,IAAM,KAAQ,EACjB,GAAI,CACF,EAAM,KAAK,CACT,KAAM,EAAK,KACX,KAAM,IAAI,OAAO,EAAK,KAAK,CAC3B,QAAS,EAAK,QACf,CAAC,MACkB,CACpB,MAAU,MAAM,iBAAiB,EAAK,OAAO,CAGjD,OAAO,EAGT,MAAa,EAAgC,CAC3C,0CAA2C,CACzC,KAAM,KACN,KAAM,gBACN,QAAS,+EACV,CACD,sBAAuB,CACrB,KAAM,KACN,KAAM,oDACN,QAAS,4FACV,CACD,eAAgB,CACd,KAAM,KACN,KAAM,cACN,QAAS,qFACV,CACD,gBAAiB,CACf,KAAM,SACN,KAAM,YACN,QAAS,gEACV,CACD,yBAA0B,CACxB,KAAM,SACN,KAAM,uBACN,QAAS,gEACV,CACD,gBAAiB,CACf,KAAM,SACN,KAAM,8CACN,QAAS,gEACV,CACD,qBAAsB,CACpB,KAAM,SACN,KAAM,oEACN,QAAS,gEACV,CACD,gBAAiB,CACf,KAAM,SACN,KAAM,UACN,QACE,oEACH,CACF"}