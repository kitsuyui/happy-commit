import{n as e}from"./chunk-DM4wYaYk.mjs";import{existsSync as t,readFileSync as n}from"fs";import{EOL as r}from"os";import*as i from"@actions/http-client";import{fetch as a}from"undici";import{getUserAgent as o}from"universal-user-agent";import s from"before-after-hook";import{request as c}from"@octokit/request";import{withCustomRequest as l}from"@octokit/graphql";import{createTokenAuth as u}from"@octokit/auth-token";import{restEndpointMethods as d}from"@octokit/plugin-rest-endpoint-methods";import{paginateRest as f}from"@octokit/plugin-paginate-rest";var p,m=e((()=>{p=class{constructor(){if(this.payload={},process.env.GITHUB_EVENT_PATH)if(t(process.env.GITHUB_EVENT_PATH))this.payload=JSON.parse(n(process.env.GITHUB_EVENT_PATH,{encoding:`utf8`}));else{let e=process.env.GITHUB_EVENT_PATH;process.stdout.write(`GITHUB_EVENT_PATH ${e} does not exist${r}`)}this.eventName=process.env.GITHUB_EVENT_NAME,this.sha=process.env.GITHUB_SHA,this.ref=process.env.GITHUB_REF,this.workflow=process.env.GITHUB_WORKFLOW,this.action=process.env.GITHUB_ACTION,this.actor=process.env.GITHUB_ACTOR,this.job=process.env.GITHUB_JOB,this.runAttempt=parseInt(process.env.GITHUB_RUN_ATTEMPT,10),this.runNumber=parseInt(process.env.GITHUB_RUN_NUMBER,10),this.runId=parseInt(process.env.GITHUB_RUN_ID,10),this.apiUrl=process.env.GITHUB_API_URL??`https://api.github.com`,this.serverUrl=process.env.GITHUB_SERVER_URL??`https://github.com`,this.graphqlUrl=process.env.GITHUB_GRAPHQL_URL??`https://api.github.com/graphql`}get issue(){let e=this.payload;return Object.assign(Object.assign({},this.repo),{number:(e.issue||e.pull_request||e).number})}get repo(){if(process.env.GITHUB_REPOSITORY){let[e,t]=process.env.GITHUB_REPOSITORY.split(`/`);return{owner:e,repo:t}}if(this.payload.repository)return{owner:this.payload.repository.owner.login,repo:this.payload.repository.name};throw Error(`context.repo requires a GITHUB_REPOSITORY environment variable like 'owner/repo'`)}}}));function h(e){return new i.HttpClient().getAgent(e)}function g(e){return new i.HttpClient().getAgentDispatcher(e)}function _(e){let t=g(e);return(e,n)=>y(this,void 0,void 0,function*(){return a(e,Object.assign(Object.assign({},n),{dispatcher:t}))})}function v(){return process.env.GITHUB_API_URL||`https://api.github.com`}var y,b=e((()=>{y=function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||=Promise)(function(n,a){function o(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){e.done?n(e.value):i(e.value).then(o,s)}c((r=r.apply(e,t||[])).next())})}})),x,S=e((()=>{x=`7.0.6`}));function C(e={}){return typeof e.debug!=`function`&&(e.debug=w),typeof e.info!=`function`&&(e.info=w),typeof e.warn!=`function`&&(e.warn=T),typeof e.error!=`function`&&(e.error=E),e}var w,T,E,D,O,k=e((()=>{S(),w=()=>{},T=console.warn.bind(console),E=console.error.bind(console),D=`octokit-core.js/${x} ${o()}`,O=class{static VERSION=x;static defaults(e){return class extends this{constructor(...t){let n=t[0]||{};if(typeof e==`function`){super(e(n));return}super(Object.assign({},e,n,n.userAgent&&e.userAgent?{userAgent:`${n.userAgent} ${e.userAgent}`}:null))}}}static plugins=[];static plugin(...e){let t=this.plugins;return class extends this{static plugins=t.concat(e.filter(e=>!t.includes(e)))}}constructor(e={}){let t=new s.Collection,n={baseUrl:c.endpoint.DEFAULTS.baseUrl,headers:{},request:Object.assign({},e.request,{hook:t.bind(null,`request`)}),mediaType:{previews:[],format:``}};if(n.headers[`user-agent`]=e.userAgent?`${e.userAgent} ${D}`:D,e.baseUrl&&(n.baseUrl=e.baseUrl),e.previews&&(n.mediaType.previews=e.previews),e.timeZone&&(n.headers[`time-zone`]=e.timeZone),this.request=c.defaults(n),this.graphql=l(this.request).defaults(n),this.log=C(e.log),this.hook=t,e.authStrategy){let{authStrategy:n,...r}=e,i=n(Object.assign({request:this.request,log:this.log,octokit:this,octokitOptions:r},e.auth));t.wrap(`request`,i.hook),this.auth=i}else if(!e.auth)this.auth=async()=>({type:`unauthenticated`});else{let n=u(e.auth);t.wrap(`request`,n.hook),this.auth=n}let r=this.constructor;for(let t=0;t<r.plugins.length;++t)Object.assign(this,r.plugins[t](this,e))}request;graphql;log;hook;auth}})),A,j,M=e((()=>{m(),b(),k(),new p,A=v(),j={baseUrl:A,request:{agent:h(A),fetch:_(A)}},O.plugin(d,f).defaults(j)})),N,P=e((()=>{m(),M(),N=new p}));async function F(e,t,n,r){let i=N,a=await I(e,t,n),{lucky:o,body:s}=r;o?a&&a.body!==s?await e.issues.updateComment({...i.repo,comment_id:a.id,body:s}):await e.issues.createComment({...i.repo,issue_number:t,body:s}):a&&await e.issues.deleteComment({...i.repo,comment_id:a.id})}async function I(e,t,n){let r=N,i=await e.issues.listComments({...r.repo,issue_number:t});for(let e of i.data)if(e.user?.login===n)return{id:e.id,body:e.body_text||``};return null}async function L(e){let t=N;return(await e.pulls.listCommits({...t.repo,pull_number:t.issue.number})).data.map(e=>e.sha)}async function R(e){return(await e.graphql(`
query {
  viewer {
    login
  }
}`)).viewer.login}var z=e((()=>{P()}));export{N as a,k as c,F as i,R as n,P as o,z as r,O as s,L as t};
//# sourceMappingURL=github-CIvZWh8R.mjs.map