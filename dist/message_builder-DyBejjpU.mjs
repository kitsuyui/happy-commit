import{n as e}from"./chunk-DM4wYaYk.mjs";import{Rules as t,t as n}from"./rules.mjs";function r(e){return typeof e==`function`}function i(e){return v(e)?`array`:typeof e}function a(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,`\\$&`)}function o(e,t){return typeof e==`object`&&!!e&&t in e}function s(e,t){return e!=null&&typeof e!=`object`&&e.hasOwnProperty&&e.hasOwnProperty(t)}function c(e,t){return y.call(e,t)}function l(e){return!c(b,e)}function u(e){return String(e).replace(/[&<>"'`=\/]/g,function(e){return x[e]})}function d(e,t){if(!e)return[];var n=!1,r=[],i=[],o=[],s=!1,c=!1,u=``,d=0;function h(){if(s&&!c)for(;o.length;)delete i[o.pop()];else o=[];s=!1,c=!1}var g,_,y;function b(e){if(typeof e==`string`&&(e=e.split(C,2)),!v(e)||e.length!==2)throw Error(`Invalid tags: `+e);g=RegExp(a(e[0])+`\\s*`),_=RegExp(`\\s*`+a(e[1])),y=RegExp(`\\s*`+a(`}`+e[1]))}b(t||D.tags);for(var x=new m(e),O,k,A,j,M,N;!x.eos();){if(O=x.pos,A=x.scanUntil(g),A)for(var P=0,F=A.length;P<F;++P)j=A.charAt(P),l(j)?(o.push(i.length),u+=j):(c=!0,n=!0,u+=` `),i.push([`text`,j,O,O+1]),O+=1,j===`
`&&(h(),u=``,d=0,n=!1);if(!x.scan(g))break;if(s=!0,k=x.scan(E)||`name`,x.scan(S),k===`=`?(A=x.scanUntil(w),x.scan(w),x.scanUntil(_)):k===`{`?(A=x.scanUntil(y),x.scan(T),x.scanUntil(_),k=`&`):A=x.scanUntil(_),!x.scan(_))throw Error(`Unclosed tag at `+x.pos);if(M=k==`>`?[k,A,O,x.pos,u,d,n]:[k,A,O,x.pos],d++,i.push(M),k===`#`||k===`^`)r.push(M);else if(k===`/`){if(N=r.pop(),!N)throw Error(`Unopened section "`+A+`" at `+O);if(N[1]!==A)throw Error(`Unclosed section "`+N[1]+`" at `+O)}else k===`name`||k===`{`||k===`&`?c=!0:k===`=`&&b(A)}if(h(),N=r.pop(),N)throw Error(`Unclosed section "`+N[1]+`" at `+x.pos);return p(f(i))}function f(e){for(var t=[],n,r,i=0,a=e.length;i<a;++i)n=e[i],n&&(n[0]===`text`&&r&&r[0]===`text`?(r[1]+=n[1],r[3]=n[3]):(t.push(n),r=n));return t}function p(e){for(var t=[],n=t,r=[],i,a,o=0,s=e.length;o<s;++o)switch(i=e[o],i[0]){case`#`:case`^`:n.push(i),r.push(i),n=i[4]=[];break;case`/`:a=r.pop(),a[5]=i[2],n=r.length>0?r[r.length-1][4]:t;break;default:n.push(i)}return t}function m(e){this.string=e,this.tail=e,this.pos=0}function h(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function g(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}var _,v,y,b,x,S,C,w,T,E,D,O,k,A=e((()=>{_=Object.prototype.toString,v=Array.isArray||function(e){return _.call(e)===`[object Array]`},y=RegExp.prototype.test,b=/\S/,x={"&":`&amp;`,"<":`&lt;`,">":`&gt;`,'"':`&quot;`,"'":`&#39;`,"/":`&#x2F;`,"`":`&#x60;`,"=":`&#x3D;`},S=/\s*/,C=/\s+/,w=/\s*=/,T=/\s*\}/,E=/#|\^|\/|>|\{|&|=|!/,m.prototype.eos=function(){return this.tail===``},m.prototype.scan=function(e){var t=this.tail.match(e);if(!t||t.index!==0)return``;var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},m.prototype.scanUntil=function(e){var t=this.tail.search(e),n;switch(t){case-1:n=this.tail,this.tail=``;break;case 0:n=``;break;default:n=this.tail.substring(0,t),this.tail=this.tail.substring(t)}return this.pos+=n.length,n},h.prototype.push=function(e){return new h(e,this)},h.prototype.lookup=function(e){var t=this.cache,n;if(t.hasOwnProperty(e))n=t[e];else{for(var i=this,a,c,l,u=!1;i;){if(e.indexOf(`.`)>0)for(a=i.view,c=e.split(`.`),l=0;a!=null&&l<c.length;)l===c.length-1&&(u=o(a,c[l])||s(a,c[l])),a=a[c[l++]];else a=i.view[e],u=o(i.view,e);if(u){n=a;break}i=i.parent}t[e]=n}return r(n)&&(n=n.call(this.view)),n},g.prototype.clearCache=function(){this.templateCache!==void 0&&this.templateCache.clear()},g.prototype.parse=function(e,t){var n=this.templateCache,r=e+`:`+(t||D.tags).join(`:`),i=n!==void 0,a=i?n.get(r):void 0;return a??(a=d(e,t),i&&n.set(r,a)),a},g.prototype.render=function(e,t,n,r){var i=this.getConfigTags(r),a=this.parse(e,i),o=t instanceof h?t:new h(t,void 0);return this.renderTokens(a,o,n,e,r)},g.prototype.renderTokens=function(e,t,n,r,i){for(var a=``,o,s,c,l=0,u=e.length;l<u;++l)c=void 0,o=e[l],s=o[0],s===`#`?c=this.renderSection(o,t,n,r,i):s===`^`?c=this.renderInverted(o,t,n,r,i):s===`>`?c=this.renderPartial(o,t,n,i):s===`&`?c=this.unescapedValue(o,t):s===`name`?c=this.escapedValue(o,t,i):s===`text`&&(c=this.rawValue(o)),c!==void 0&&(a+=c);return a},g.prototype.renderSection=function(e,t,n,i,a){var o=this,s=``,c=t.lookup(e[1]);function l(e){return o.render(e,t,n,a)}if(c){if(v(c))for(var u=0,d=c.length;u<d;++u)s+=this.renderTokens(e[4],t.push(c[u]),n,i,a);else if(typeof c==`object`||typeof c==`string`||typeof c==`number`)s+=this.renderTokens(e[4],t.push(c),n,i,a);else if(r(c)){if(typeof i!=`string`)throw Error(`Cannot use higher-order sections without the original template`);c=c.call(t.view,i.slice(e[3],e[5]),l),c!=null&&(s+=c)}else s+=this.renderTokens(e[4],t,n,i,a);return s}},g.prototype.renderInverted=function(e,t,n,r,i){var a=t.lookup(e[1]);if(!a||v(a)&&a.length===0)return this.renderTokens(e[4],t,n,r,i)},g.prototype.indentPartial=function(e,t,n){for(var r=t.replace(/[^ \t]/g,``),i=e.split(`
`),a=0;a<i.length;a++)i[a].length&&(a>0||!n)&&(i[a]=r+i[a]);return i.join(`
`)},g.prototype.renderPartial=function(e,t,n,i){if(n){var a=this.getConfigTags(i),o=r(n)?n(e[1]):n[e[1]];if(o!=null){var s=e[6],c=e[5],l=e[4],u=o;c==0&&l&&(u=this.indentPartial(o,l,s));var d=this.parse(u,a);return this.renderTokens(d,t,n,u,i)}}},g.prototype.unescapedValue=function(e,t){var n=t.lookup(e[1]);if(n!=null)return n},g.prototype.escapedValue=function(e,t,n){var r=this.getConfigEscape(n)||D.escape,i=t.lookup(e[1]);if(i!=null)return typeof i==`number`&&r===D.escape?String(i):r(i)},g.prototype.rawValue=function(e){return e[1]},g.prototype.getConfigTags=function(e){if(v(e))return e;if(e&&typeof e==`object`)return e.tags},g.prototype.getConfigEscape=function(e){if(e&&typeof e==`object`&&!v(e))return e.escape},D={name:`mustache.js`,version:`4.2.0`,tags:[`{{`,`}}`],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(e){O.templateCache=e},get templateCache(){return O.templateCache}},O=new g,D.clearCache=function(){return O.clearCache()},D.parse=function(e,t){return O.parse(e,t)},D.render=function(e,t,n,r){if(typeof e!=`string`)throw TypeError(`Invalid template! Template should be a "string" but "`+i(e)+`" was given as the first argument for mustache#render(template, view, partials)`);return O.render(e,t,n,r)},D.escape=u,D.Scanner=m,D.Context=h,D.Writer=g,k=D})),j,M,N,P=e((()=>{A(),n(),j=class{rules;baseTemplate;constructor(e,t){this.rules=e,this.baseTemplate=t}prRules(){return this.rules.filter(e=>e.kind===`pr`)}commitRules(){return this.rules.filter(e=>e.kind===`commit`)}build(e){let{commitIds:t,prNum:n}=e,r=[],i=!1;for(let{rule:e,message:t}of this.prRules()){let a=n.toString().match(e);if(a){let e=k.render(t,{matched:a,prNum:n});r.push(e),i=!0}}for(let{rule:e,message:n}of this.commitRules())for(let a of t){let t=a.match(e);if(t){let e=k.render(n,{matched:t,commitId:a});r.push(e),i=!0}}let a=k.render(this.baseTemplate,{messages:r});return{lucky:i,body:a}}},M={pr_reaches_contain_only_one_nonzero_digit:!0,pr_reaches_power_of_2:!0,pr_reaches_777:!0,commit_hits_777:!0,commit_hits_same_numbers:!0,commit_hits_123:!0,commit_hits_hexspeak:!0,commit_hits_666:!0},N=class{builder;constructor(e,n={},r=[]){this.builder=new j([...r].concat(Object.entries(t).filter(([e])=>e in n?n[e]:M[e]).map(([,e])=>e)),e)}build(e){return this.builder.build(e)}}}));export{P as n,N as t};
//# sourceMappingURL=message_builder-DyBejjpU.mjs.map